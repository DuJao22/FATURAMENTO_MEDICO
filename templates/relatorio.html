{% extends "base.html" %}

{% block title %}Relatório - {{ relatorio.profissional }}{% endblock %}

{% block header %}Relatório de {{ relatorio.profissional }}{% endblock %}

{% block nav_extra %}
<div class="date-filter">
    <input type="date" id="data_inicio" placeholder="Data Início" value="{{ request.args.get('data_inicio', '') }}">
    <input type="date" id="data_fim" placeholder="Data Fim" value="{{ request.args.get('data_fim', '') }}">
    <button onclick="applyDateFilter()">Filtrar</button>
    <button onclick="clearDateFilter()" class="btn-secondary">Limpar</button>
</div>
{% endblock %}

{% block content %}
<div class="card">
    <h2>Informações do Profissional</h2>
    <p><strong>Nome:</strong> {{ relatorio.profissional }}</p>
    <p><strong>Especialidade:</strong> {{ relatorio.especialidade }}</p>
    {% if request.args.get('data_inicio') and request.args.get('data_fim') %}
    <p><strong>Período:</strong> {{ request.args.get('data_inicio') }} a {{ request.args.get('data_fim') }}</p>
    {% endif %}
</div>

<div class="stats">
    <div class="stat-card">
        <h3>{{ relatorio.total_atendimentos }}</h3>
        <p>Total de Atendimentos</p>
    </div>
    <div class="stat-card">
        <h3>R$ {{ "%.2f"|format(relatorio.total_profissional) }}</h3>
        <p>Total Profissional</p>
    </div>
    <div class="stat-card">
        <h3>R$ {{ "%.2f"|format(relatorio.total_empresa) }}</h3>
        <p>Total Empresa</p>
    </div>
    <div class="stat-card">
        <h3>R$ {{ "%.2f"|format(relatorio.total_profissional + relatorio.total_empresa) }}</h3>
        <p>Total Geral</p>
    </div>
</div>

<div class="card">
    <h2>Detalhamento por Convênio</h2>
    {% if relatorio.convenios %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Convênio</th>
                    <th>Quantidade</th>
                    <th>Valor Unit. Prof.</th>
                    <th>Valor Unit. Emp.</th>
                    <th>Total Profissional</th>
                    <th>Total Empresa</th>
                    <th>Total Geral</th>
                </tr>
            </thead>
            <tbody>
                {% for convenio, dados in relatorio.convenios.items() %}
                <tr class="convenio-{{ convenio.lower().replace(' ', '-') }}">
                    <td><strong>{{ convenio }}</strong></td>
                    <td>{{ dados.quantidade }}</td>
                    <td class="currency">R$ {{ "%.2f"|format(dados.valor_unitario_prof) }}</td>
                    <td class="currency">R$ {{ "%.2f"|format(dados.valor_unitario_emp) }}</td>
                    <td class="currency">R$ {{ "%.2f"|format(dados.total_profissional) }}</td>
                    <td class="currency">R$ {{ "%.2f"|format(dados.total_empresa) }}</td>
                    <td class="currency">R$ {{ "%.2f"|format(dados.total_profissional + dados.total_empresa) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p style="text-align: center; color: #666; padding: 20px;">
        Nenhum atendimento com presença "Ok" encontrado para este profissional no período selecionado.
    </p>
    {% endif %}
</div>

<div class="card">
    <h2>Observações</h2>
    <ul style="color: #666; line-height: 1.6;">
        <li>Apenas atendimentos com presença "Ok" são contabilizados</li>
        <li>Valores são calculados automaticamente baseados no convênio</li>
        <li>Total Geral = Total Profissional + Total Empresa</li>
        <li>Use os filtros de data para visualizar períodos específicos</li>
    </ul>
</div>

<div style="text-align: center; margin-top: 30px;">
    <a href="/" class="btn btn-secondary">Voltar ao Início</a>
    <a href="/relatorio/todos" class="btn">Ver Relatório Geral</a>
</div>
{% endblock %}